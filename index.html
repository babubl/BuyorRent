<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Buy vs Rent â€” Pro v1</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter","ui-sans-serif","system-ui","Segoe UI","Roboto"] },
          colors: { brand: { 500:'#6366f1' }, win:'#22c55e', rent:'#0ea5e9' }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    body{
      background:
        radial-gradient(1000px 700px at 20% 10%, #0ea5e9 10%, transparent 60%),
        radial-gradient(1200px 800px at 80% 0%, #8b5cf6 10%, transparent 60%),
        linear-gradient(180deg, #0b1020, #0b1020 30%, #0f172a 100%);
      color:#e5e7eb;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .card{ border-radius: 1rem; background: rgba(15,23,42,.72); backdrop-filter: blur(6px); border:1px solid rgba(148,163,184,.18); box-shadow: 0 8px 30px rgba(2,6,23,.35); }
    .label{ font-size:.95rem; color:#e2e8f0 }
    .input, .select, input[type=range]{ width:100%; border-radius:.75rem; border:1px solid rgba(148,163,184,.35); padding:.65rem .85rem; outline:none; background: rgba(2,6,23,.65); color:#f8fafc }
    .input:focus, .select:focus{ box-shadow:0 0 0 2px #6366f14d; border-color:#6366f1 }
    .btn{ display:inline-flex; align-items:center; gap:.55rem; border-radius:.8rem; padding:.65rem 1rem; font-weight:700; background:#f8fafc; color:#0b1020 }
    .pill{ display:inline-flex; align-items:center; gap:.5rem; border-radius:9999px; padding:.35rem .8rem; background:#0ea5e9; color:#001018; font-weight:800 }
    .pill.win{ background:#22c55e; color:#00140a }
    .kpi{ font-size: clamp(1.6rem, 3.2vw, 2.4rem); font-weight: 900; letter-spacing: -.01em; }
    .muted{ color:#a7b0c0; font-size:.9rem }
    .subtle{ color:#94a3b8; font-size:.9rem }
    .bar-bg{ height:.75rem; border-radius:9999px; background:rgba(148,163,184,.25) }
    .bar-fill{ height:100%; border-radius:9999px }
    .chip{ display:inline-flex; align-items:center; gap:.35rem; padding:.35rem .7rem; border-radius:9999px; background:#111827; border:1px solid rgba(148,163,184,.35); cursor:pointer; }
    table{ width:100%; border-collapse: collapse; }
    th, td{ padding:.5rem .6rem; border-bottom:1px solid rgba(148,163,184,.15); text-align:right; }
    th:first-child, td:first-child{ text-align:left; }
    details pre{ background:rgba(0,0,0,.3); padding:1rem; border-radius:.6rem; white-space:pre-wrap; }
  </style>
</head>
<body class="min-h-screen font-sans">
  <div class="max-w-7xl mx-auto p-6 md:p-10 space-y-8">

    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Buy vs Rent â€” Pro</h1>
        <p class="subtle mt-1">Tidy inputs. Honest math. Clear outcome. Presets + sensitivity + break-even.</p>
      </div>
      <div class="flex gap-3 flex-wrap">
        <button id="btnRun" class="btn" type="button">Run</button>
        <button id="btnReset" class="btn" type="button">Reset</button>
      </div>
    </header>

    <!-- Quick Presets -->
    <section class="card p-4">
      <div class="flex items-center gap-3 flex-wrap text-sm">
        <span class="subtle">Presets:</span>
        <button class="chip" data-preset="tier1">Tierâ€‘1 City</button>
        <button class="chip" data-preset="tier2">Tierâ€‘2 City</button>
        <button class="chip" data-preset="highrent">Highâ€‘rent Market</button>
      </div>
    </section>

    <!-- Inputs -->
    <section class="grid grid-cols-1 xl:grid-cols-4 gap-6">
      <!-- Property & Horizon -->
      <div class="card p-6 space-y-4">
        <h3 class="text-lg font-semibold">Property & Horizon</h3>
        <label class="label">Property Value (â‚¹)</label><input id="propVal" class="input" type="number" value="15000000">
        <label class="label">Down Payment (â‚¹)</label><input id="downPayment" class="input" type="number" value="5000000">
        <label class="label">Stamp Duty + Registration (%)</label><input id="stampRate" class="input" type="number" value="11">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Stay Duration (years)</label><input id="stayYears" class="input" type="number" value="10"></div>
          <div><label class="label">Property Appreciation (%/yr)</label><input id="propApp" class="input" type="number" value="5"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Seller Brokerage at Exit (%)</label><input id="sellBrokerPct" class="input" type="number" value="2"></div>
          <div><label class="label">Fitâ€‘out / Furnishing (â‚¹)</label><input id="fitOut" class="input" type="number" value="0"></div>
        </div>
      </div>

      <!-- Loan -->
      <div class="card p-6 space-y-4">
        <h3 class="text-lg font-semibold">Loan</h3>
        <label class="label">Home Loan Interest (%/yr)</label><input id="loanRate" class="input" type="number" value="8">
        <label class="label">Loan Tenure (years)</label><input id="loanTenure" class="input" type="number" value="20">
      </div>

      <!-- Rent -->
      <div class="card p-6 space-y-4">
        <h3 class="text-lg font-semibold">Rent</h3>
        <label class="label">Initial Monthly Rent (â‚¹)</label><input id="rent0" class="input" type="number" value="40000">
        <label class="label">Tenant Maintenance (â‚¹/mo)</label><input id="tenantMaint0" class="input" type="number" value="2000">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Increase Interval (months)</label><input id="incInterval" class="input" type="number" value="24"></div>
          <div><label class="label">Increase per Step (%)</label><input id="incRate" class="input" type="number" value="10"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Security Deposit (months)</label><input id="depositMonths" class="input" type="number" value="2"></div>
          <div><label class="label">Deposit Refund (%)</label><input id="depositRefundPct" class="input" type="number" value="100"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Rent Brokerage (months)</label><input id="rentBrokerMonths" class="input" type="number" value="1"></div>
          <div><label class="label">Relocation / Setup (â‚¹)</label><input id="moveCost" class="input" type="number" value="0"></div>
        </div>
      </div>

      <!-- Owner Costs & Investments -->
      <div class="card p-6 space-y-4">
        <h3 class="text-lg font-semibold">Owner Costs & Investments</h3>
        <label class="label">Owner Maintenance (â‚¹/mo)</label><input id="ownerMaint0" class="input" type="number" value="5000">
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Maint Escalation (%/yr)</label><input id="maintEsc" class="input" type="number" value="5"></div>
          <div><label class="label">MF Return (%/yr)</label><input id="mfRate" class="input" type="number" value="12"></div>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div><label class="label">Property Tax (â‚¹/yr)</label><input id="propTaxYear" class="input" type="number" value="10000"></div>
          <div><label class="label">Home Insurance (â‚¹/yr)</label><input id="homeInsYear" class="input" type="number" value="5000"></div>
        </div>
        <label class="flex items-center gap-2"><input id="includeStampInMF" type="checkbox" checked class="h-4 w-4"><span class="label">Invest avoided stamp duty if renting</span></label>
      </div>
    </section>

    <!-- Taxes (simple toggles) -->
    <section class="card p-6 space-y-4">
      <h3 class="text-lg font-semibold">Taxes (Simple)</h3>
      <label class="flex items-center gap-2"><input id="applyTax" type="checkbox" class="h-4 w-4"><span class="label">Apply HRA + Sec 24(b) + Sec 80C credits (approx)</span></label>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div><label class="label">HRA monthly savings (â‚¹)</label><input id="hraSaving" class="input" type="number" value="0"></div>
        <div><label class="label">Sec 24(b) cap (â‚¹/yr)</label><input id="sec24Cap" class="input" type="number" value="200000"></div>
        <div><label class="label">Sec 80C cap (â‚¹/yr)</label><input id="sec80cCap" class="input" type="number" value="150000"></div>
      </div>
      <p class="subtle">Approximation: credits applied at year-end against owner cash outflow; HRA reduces effective rent monthly.</p>
    </section>

    <!-- Sensitivity -->
    <section class="card p-6 space-y-3">
      <h3 class="text-lg font-semibold">Sensitivity (Quick Sweep)</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label class="label">Property Appreciation %</label>
          <input id="propAppSlider" type="range" min="0" max="10" value="5" step="0.5">
          <div class="subtle">Current: <span id="propAppVal">5</span>%</div>
        </div>
        <div>
          <label class="label">MF Return %</label>
          <input id="mfRateSlider" type="range" min="6" max="15" value="12" step="0.5">
          <div class="subtle">Current: <span id="mfRateVal">12</span>%</div>
        </div>
      </div>
      <p class="subtle">These sliders adjust the inputs above and re-run instantly.</p>
    </section>

    <!-- Results -->
    <section class="card p-6 space-y-4">
      <div class="flex items-center justify-between flex-wrap gap-3">
        <h3 class="text-lg font-semibold">Results</h3>
        <span id="winnerBadge" class="pill">â€”</span>
      </div>

      <div class="space-y-2">
        <div class="bar-bg"><div id="deltaBar" class="bar-fill" style="width:0%"></div></div>
        <div id="deltaText" class="muted">â€”</div>
        <div class="muted">ðŸ•’ Break-even: <span id="breakEvenText">â€”</span></div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="p-4 rounded-xl bg-black/30 border border-white/10">
          <div class="subtle">BUY (Property FV âˆ’ Loan Outstanding âˆ’ Exit Brokerage)</div>
          <div id="kpiBuy" class="kpi mt-1">â€”</div>
          <div class="mt-2 text-sm" id="buyNotes">â€”</div>
        </div>
        <div class="p-4 rounded-xl bg-black/30 border border-white/10">
          <div class="subtle">RENT (MF Value + Deposit Refund)</div>
          <div id="kpiRent" class="kpi mt-1">â€”</div>
          <div class="mt-2 text-sm" id="rentNotes">â€”</div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
        <div class="p-4 rounded-xl bg-black/20 border border-white/10"><div class="subtle">Total Rent + Maint (after HRA)</div><div id="kpiRentTotal" class="kpi mt-1">â€”</div></div>
        <div class="p-4 rounded-xl bg-black/20 border border-white/10"><div class="subtle">Total EMI + Owner Maint + Tax/Ins (after credits)</div><div id="kpiBuyTotal" class="kpi mt-1">â€”</div></div>
        <div class="p-4 rounded-xl bg-black/20 border border-white/10"><div class="subtle">Upfront Stamp Duty</div><div id="kpiStamp" class="kpi mt-1">â€”</div></div>
      </div>

      <!-- Expandable calculations + per-year summary -->
      <details class="mt-6">
        <summary class="cursor-pointer select-none text-brand-500 font-semibold">Show calculations & perâ€‘year summary</summary>
        <div class="mt-4 grid grid-cols-1 gap-6">
          <pre id="calcText">â€”</pre>
          <div class="overflow-x-auto">
            <table id="yearTable" class="text-sm">
              <thead>
                <tr>
                  <th>Year</th>
                  <th>Buy: Equity (â‚¹)</th>
                  <th>Rent: MF Value (â‚¹)</th>
                  <th>Total Rent Paid (â‚¹)</th>
                  <th>Total EMI Paid (â‚¹)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </details>
    </section>

    <footer class="text-center text-xs text-slate-300 pb-10">Â© Buy vs Rent â€¢ Planning only; not advice.</footer>
  </div>

  <script>
    // ---------- Helpers ----------
    const $ = (id)=> document.getElementById(id);
    const fmt = (n)=> (n==null||isNaN(n))? 'â€”' : new Intl.NumberFormat('en-IN',{maximumFractionDigits:0}).format(Math.round(n));
    const clamp = (v, lo, hi)=> Math.max(lo, Math.min(hi, v));
    function pmt(r,n,pv){ if(r===0) return n? pv/n : 0; const f=Math.pow(1+r,n); return (pv*r*f)/(f-1); }
    function pvExcel(r,n,pmtVal,fv=0){ if(r===0) return -(fv+pmtVal*n); return -( pmtVal*(1-Math.pow(1+r,-n))/r + fv*Math.pow(1+r,-n) ); }
    function loanOutstanding(r,n,pmtVal,k){ const remain = Math.max(0, n-k); return -pvExcel(r, remain, pmtVal, 0); }
    function seriesWithStep(initial, months, stepM, stepR){ const out=[]; const safeStepM = stepM>0 ? stepM : months+1; for(let m=1;m<=months;m++){ const steps=Math.floor((m-1)/safeStepM); out.push(initial*Math.pow(1+stepR, steps)); } return out; }
    function seriesEscalating(initial, months, yearly){ const out=[]; const m = Math.pow(1+yearly/100,1/12)-1; let v=initial; for(let i=0;i<months;i++){ out.push(v); v = v*(1+m); } return out; }

    // ---------- Inputs ----------
    function pullInputs(){
      const gv=id=>+($(id).value||0);
      return {
        propVal:gv('propVal'), downPayment:gv('downPayment'), stampRate:gv('stampRate')/100,
        stayYears:gv('stayYears'), propApp:gv('propApp')/100, sellBrokerPct:gv('sellBrokerPct')/100, fitOut:gv('fitOut'),
        loanRateAnnual:gv('loanRate')/100, loanTenureYears:gv('loanTenure'),
        rent0:gv('rent0'), tenantMaint0:gv('tenantMaint0'), incInterval:gv('incInterval'), incRate:gv('incRate')/100,
        depositMonths:gv('depositMonths'), depositRefundPct:gv('depositRefundPct')/100, rentBrokerMonths:gv('rentBrokerMonths'), moveCost:gv('moveCost'),
        ownerMaint0:gv('ownerMaint0'), maintEsc:gv('maintEsc'), mfRateAnnual:gv('mfRate')/100,
        propTaxYear:gv('propTaxYear'), homeInsYear:gv('homeInsYear'),
        includeStampInMF:$('includeStampInMF').checked,
        applyTax:$('applyTax').checked, hraSaving:gv('hraSaving'), sec24Cap:gv('sec24Cap'), sec80cCap:gv('sec80cCap')
      };
    }

    // ---------- Core compute ----------
    function computeScenario(inp){
      const months = Math.round(inp.stayYears*12);
      const rM = inp.loanRateAnnual/12;
      const rAppM = Math.pow(1+inp.propApp,1/12)-1;
      const mfM = Math.pow(1+inp.mfRateAnnual,1/12)-1;

      const loanAmt = Math.max(0, inp.propVal - inp.downPayment);
      const nTotal = Math.floor(inp.loanTenureYears*12);
      const emi = loanAmt>0 ? pmt(rM, nTotal, loanAmt) : 0;
      const stampAmt = inp.propVal*inp.stampRate;

      // Rent & maint series
      const rentSeries = seriesWithStep(inp.rent0, months, inp.incInterval, inp.incRate);
      const tenantMaintSeries = seriesWithStep(inp.tenantMaint0, months, inp.incInterval, inp.incRate);
      const ownerMaintSeries = seriesEscalating(inp.ownerMaint0, months, inp.maintEsc);

      // Upfronts for rent path
      const deposit = inp.rent0 * inp.depositMonths;
      const brokerage = inp.rent0 * inp.rentBrokerMonths;
      const depositRefund = deposit * clamp(inp.depositRefundPct,0,1);

      // Rent path starting corpus
      let mf = inp.downPayment + (inp.includeStampInMF? stampAmt: 0) - deposit - brokerage - inp.moveCost;
      if(mf<0) mf=0;

      let totalRentEff=0, totalOwn=0;
      let yInt=0, yPrin=0;
      const perYear = [];
      const tol = 50000;
      let beMonth = null, prevDiff=null;

      for(let i=0;i<months;i++){
        const rent = rentSeries[i]||0;
        const tMaint = tenantMaintSeries[i]||0;
        const rentEff = Math.max(0, rent + tMaint - (inp.applyTax ? inp.hraSaving : 0));

        const oMaint = ownerMaintSeries[i]||0;
        const extras = (inp.propTaxYear + inp.homeInsYear)/12;
        const ownMaintTaxIns = oMaint + extras;

        const outPrev = loanOutstanding(rM, nTotal, emi, i);
        const interest = outPrev*rM;
        const principal = Math.max(0, emi - interest);
        yInt += interest; yPrin += principal;

        // year-end tax credits (approx applied monthly after year end by pro-rating)
        let credit = 0;
        if(inp.applyTax && ((i+1)%12===0)){
          const allowI = Math.min(inp.sec24Cap, yInt);
          const allowP = Math.min(inp.sec80cCap, yPrin);
          credit = (allowI + allowP)/12; // spread as avg monthly reduction
          yInt=0; yPrin=0;
        }

        const ownTotal = emi + ownMaintTaxIns - (inp.applyTax ? credit : 0);
        const surplus = Math.max(ownTotal - rentEff, 0);
        mf = mf*(1+mfM) + surplus;

        totalRentEff += rentEff;
        totalOwn += ownTotal;

        // wealth this month
        const outNow = loanOutstanding(rM, nTotal, emi, i+1);
        const fvNow = inp.propVal*Math.pow(1+rAppM, i+1);
        const buyWealthNow = fvNow - outNow;
        const rentWealthNow = mf;
        const diff = buyWealthNow - rentWealthNow;

        if(beMonth===null){
          if(Math.abs(diff)<=tol){ beMonth=i+1; }
          else if(prevDiff!==null && (prevDiff>0)!==(diff>0)){
            const f = Math.abs(prevDiff)/(Math.abs(prevDiff)+Math.abs(diff));
            beMonth = i + f;
          }
        }
        prevDiff = diff;

        // capture year rows
        if((i+1)%12===0){
          const yr=(i+1)/12;
          perYear.push({
            year: yr,
            buyEq: buyWealthNow,
            mfVal: rentWealthNow,
            rentPaid: totalRentEff,
            emiPaid: totalOwn
          });
        }
      }

      const fvEnd = inp.propVal*Math.pow(1+inp.propApp, inp.stayYears);
      const outEnd = loanOutstanding(rM, nTotal, emi, Math.min(months, nTotal));
      const exitBroker = fvEnd * clamp(inp.sellBrokerPct,0,1);
      const endBuy = fvEnd - outEnd - exitBroker - inp.fitOut;
      const endRent = mf + depositRefund;

      return { endBuy, endRent, totalRentEff, totalOwn, stampAmt, emi, loanAmt, beMonth, perYear, exitBroker, depositRefund };
    }

    // ---------- Render ----------
    function render(a, inp){
      const k=(id,v)=>($(id).textContent = v);

      k('kpiBuy','â‚¹'+fmt(a.endBuy));
      k('kpiRent','â‚¹'+fmt(a.endRent));
      k('kpiRentTotal','â‚¹'+fmt(a.totalRentEff));
      k('kpiBuyTotal','â‚¹'+fmt(a.totalOwn));
      k('kpiStamp','â‚¹'+fmt(a.stampAmt));

      const win = a.endBuy>a.endRent ? 'BUY' : (a.endRent>a.endBuy ? 'RENT' : 'TIE');
      const badge = $('winnerBadge');
      badge.textContent = 'Winner: '+win;
      badge.className = 'pill '+(win==='BUY'?'win':'');

      const deltaAbs = Math.abs(a.endBuy - a.endRent);
      const deltaPct = (deltaAbs / Math.max(a.endBuy, a.endRent) || 0) * 100;
      const bar = $('deltaBar');
      bar.style.width = Math.max(0, Math.min(100, deltaPct)).toFixed(1)+'%';
      bar.style.background = (win==='BUY')? '#22c55e' : '#0ea5e9';
      k('deltaText', (win==='TIE') ? 'Both paths are equal under current inputs.' : `${win} ahead by â‚¹${fmt(deltaAbs)} (~${deltaPct.toFixed(1)}% of the larger outcome)`);

      if(a.beMonth && isFinite(a.beMonth)){
        const y = a.beMonth/12;
        const yInt = Math.floor(a.beMonth/12);
        const mRem = Math.round(a.beMonth - yInt*12);
        k('breakEvenText', `${y.toFixed(1)} years (${yInt}y ${mRem}m)`);
      } else {
        k('breakEvenText','Not within your horizon');
      }

      $('buyNotes').textContent = `Loan â‚¹${fmt(a.loanAmt)} | EMI â‚¹${fmt(a.emi)} / mo | Exit brokerage â‚¹${fmt(a.exitBroker)}`;
      $('rentNotes').textContent = `Starts with corpus = Down Payment + ${inp.includeStampInMF?'Stamp':''} âˆ’ deposit/brokerage/setup; Deposit refund at exit â‚¹${fmt(a.depositRefund)}`;

      // per-year table
      const tbody = document.querySelector('#yearTable tbody');
      tbody.innerHTML = '';
      a.perYear.forEach(row=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${row.year}</td><td>â‚¹${fmt(row.buyEq)}</td><td>â‚¹${fmt(row.mfVal)}</td><td>â‚¹${fmt(row.rentPaid)}</td><td>â‚¹${fmt(row.emiPaid)}</td>`;
        tbody.appendChild(tr);
      });

      // calc text summary
      const lines = [];
      lines.push(`Loan amount = max(Property âˆ’ Down Payment, 0) = â‚¹${fmt(inp.propVal)} âˆ’ â‚¹${fmt(inp.downPayment)} = â‚¹${fmt(a.loanAmt)}`);
      lines.push(`EMI = PÂ·rÂ·(1+r)^n / [(1+r)^n âˆ’ 1]; P=â‚¹${fmt(a.loanAmt)}, r=${(inp.loanRateAnnual*100/12).toFixed(3)}%/mo, n=${Math.floor(inp.loanTenureYears*12)}`);
      lines.push(`Property FV (end) = â‚¹${fmt(inp.propVal)} Â· (1+${(inp.propApp*100).toFixed(2)}%)^${inp.stayYears} = â‚¹${fmt(inp.propVal*Math.pow(1+inp.propApp, inp.stayYears))}`);
      lines.push(`Owner costs = Maint (esc ${inp.maintEsc}%/yr) + Tax â‚¹${fmt(inp.propTaxYear)}/yr + Ins â‚¹${fmt(inp.homeInsYear)}/yr`);
      lines.push(`Rent path upfront = deposit â‚¹${fmt(inp.rent0*inp.depositMonths)}, brokerage â‚¹${fmt(inp.rent0*inp.rentBrokerMonths)}, setup â‚¹${fmt(inp.moveCost)}`);
      if(inp.applyTax){
        lines.push(`Tax credits (approx): HRA â‚¹${fmt(inp.hraSaving)}/mo; Sec24 cap â‚¹${fmt(inp.sec24Cap)}/yr; Sec80C cap â‚¹${fmt(inp.sec80cCap)}/yr`);
      }
      lines.push(`Exit: Brokerage ${ (inp.sellBrokerPct*100).toFixed(1)}% = â‚¹${fmt(a.exitBroker)}; Fitâ€‘out deducted â‚¹${fmt(inp.fitOut)}`);
      lines.push(`Ending wealth â†’ Buy: â‚¹${fmt(a.endBuy)} ; Rent: â‚¹${fmt(a.endRent)}`);
      $('calcText').textContent = lines.join('\n');
    }

    // ---------- Controllers ----------
    function run(){ const inp=pullInputs(); const res=computeScenario(inp); render(res, inp); }
    function reset(){
      const defaults = {
        propVal:15000000, downPayment:5000000, stampRate:11, stayYears:10, propApp:5, sellBrokerPct:2, fitOut:0,
        loanRate:8, loanTenure:20,
        rent0:40000, tenantMaint0:2000, incInterval:24, incRate:10, depositMonths:2, depositRefundPct:100, rentBrokerMonths:1, moveCost:0,
        ownerMaint0:5000, maintEsc:5, mfRate:12, propTaxYear:10000, homeInsYear:5000,
        hraSaving:0, sec24Cap:200000, sec80cCap:150000
      };
      for(const [k,v] of Object.entries(defaults)){
        const el=$(k); if(!el) continue;
        if(el.type==='checkbox'){ el.checked = !!v; } else { el.value = v; }
      }
      $('includeStampInMF').checked = true;
      $('applyTax').checked = false;
      $('propAppSlider').value = 5; $('propAppVal').textContent = '5';
      $('mfRateSlider').value = 12; $('mfRateVal').textContent = '12';
      run();
    }

    // Sensitivity sliders sync
    function hookSensitivity(){
      $('propAppSlider').addEventListener('input', e=>{ $('propApp').value = e.target.value; $('propAppVal').textContent = e.target.value; run(); });
      $('mfRateSlider').addEventListener('input', e=>{ $('mfRate').value = e.target.value; $('mfRateVal').textContent = e.target.value; run(); });
    }

    // Presets
    function applyPreset(name){
      if(name==='tier1'){
        $('rent0').value=60000; $('incRate').value=10; $('incInterval').value=11;
        $('stampRate').value=7; $('propApp').value=5; $('mfRate').value=12;
      } else if(name==='tier2'){
        $('rent0').value=30000; $('incRate').value=8; $('incInterval').value=24;
        $('stampRate').value=6; $('propApp').value=4; $('mfRate').value=11;
      } else if(name==='highrent'){
        $('rent0').value=80000; $('incRate').value=10; $('incInterval').value=12;
        $('stampRate').value=8; $('propApp').value=5; $('mfRate').value=12;
      }
      $('propAppSlider').value = $('propApp').value; $('propAppVal').textContent = $('propApp').value;
      $('mfRateSlider').value = $('mfRate').value; $('mfRateVal').textContent = $('mfRate').value;
      run();
    }

    function hookPresets(){
      document.querySelectorAll('.chip[data-preset]').forEach(btn=>{
        btn.addEventListener('click', ()=> applyPreset(btn.dataset.preset));
      });
    }

    // Boot
    window.addEventListener('DOMContentLoaded', ()=>{
      hookSensitivity();
      hookPresets();
      $('btnRun').onclick=run;
      $('btnReset').onclick=reset;
      reset(); // sets defaults and runs once
    });
  </script>
</body>
</html>
