<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Buy vs Rent</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter","ui-sans-serif","system-ui","Segoe UI","Roboto"] },
          colors: { brand: { 500:'#6366f1' }, win:'#22c55e', rent:'#0ea5e9' }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <style>
    body{ background:linear-gradient(180deg,#0b1020,#0f172a); color:#e5e7eb; }
    .card{ border-radius:1rem; background:rgba(15,23,42,.72); padding:1.5rem; margin-bottom:1rem; }
    .label{ font-size:.95rem; color:#e2e8f0; display:block; margin-top:.5rem; }
    .input{ width:100%; border-radius:.75rem; border:1px solid rgba(148,163,184,.35); padding:.6rem; background:rgba(2,6,23,.65); color:#f8fafc; }
    .btn{ padding:.6rem 1rem; border-radius:.75rem; font-weight:700; background:#f8fafc; color:#111; margin-right:.5rem; }
    .kpi{ font-size:1.8rem; font-weight:800; }
    .pill{ display:inline-block; padding:.3rem .8rem; border-radius:9999px; font-weight:700; background:#0ea5e9; color:#001018; }
    .pill.win{ background:#22c55e; color:#00140a; }
    details{ margin-top:1rem; }
    details pre{ background:rgba(0,0,0,.3); padding:1rem; border-radius:.5rem; font-size:.85rem; white-space:pre-wrap; }
  </style>
</head>
<body class="font-sans">
  <div class="max-w-5xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-3xl font-extrabold">Buy vs Rent</h1>
      <div>
        <button id="btnRun" class="btn">Run</button>
        <button id="btnReset" class="btn">Reset</button>
      </div>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="card">
        <h3 class="text-lg font-semibold">Property</h3>
        <label class="label">Property Value (₹)</label>
        <input id="propVal" class="input" type="number" value="15000000">
        <label class="label">Down Payment (₹)</label>
        <input id="downPayment" class="input" type="number" value="5000000">
        <label class="label">Stamp Duty (%)</label>
        <input id="stampRate" class="input" type="number" value="11">
        <label class="label">Stay Duration (years)</label>
        <input id="stayYears" class="input" type="number" value="10">
        <label class="label">Property Appreciation (%)</label>
        <input id="propApp" class="input" type="number" value="5">
      </div>

      <div class="card">
        <h3 class="text-lg font-semibold">Loan</h3>
        <label class="label">Loan Interest (%)</label>
        <input id="loanRate" class="input" type="number" value="8">
        <label class="label">Loan Tenure (years)</label>
        <input id="loanTenure" class="input" type="number" value="20">
      </div>

      <div class="card">
        <h3 class="text-lg font-semibold">Rent & Investments</h3>
        <label class="label">Initial Rent (₹)</label>
        <input id="rent0" class="input" type="number" value="40000">
        <label class="label">Maintenance (₹/mo)</label>
        <input id="maint0" class="input" type="number" value="5000">
        <label class="label">Increase Interval (months)</label>
        <input id="incInterval" class="input" type="number" value="24">
        <label class="label">Increase per Step (%)</label>
        <input id="incRate" class="input" type="number" value="10">
        <label class="label">MF Return (%)</label>
        <input id="mfRate" class="input" type="number" value="12">
        <label class="flex items-center mt-2"><input id="includeStampInMF" type="checkbox" checked class="mr-2"> Invest Stamp Duty if renting</label>
      </div>
    </section>

    <section class="card mt-6">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold">Results</h3>
        <span id="winnerBadge" class="pill">—</span>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div><div class="sub">BUY</div><div id="kpiBuy" class="kpi">—</div><div id="buyNotes" class="text-sm">—</div></div>
        <div><div class="sub">RENT</div><div id="kpiRent" class="kpi">—</div><div id="rentNotes" class="text-sm">—</div></div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
        <div>Total Rent+Maint: <span id="kpiRentTotal" class="font-bold">—</span></div>
        <div>Total EMI+Maint: <span id="kpiBuyTotal" class="font-bold">—</span></div>
        <div>Stamp Duty: <span id="kpiStamp" class="font-bold">—</span></div>
      </div>
      <details>
        <summary class="cursor-pointer text-brand-500 font-semibold">Show calculations</summary>
        <pre id="calcText">—</pre>
      </details>
    </section>

    <footer class="text-center text-xs text-slate-300 mt-6">© Buy vs Rent • Planning only; not advice.</footer>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const fmt = n => (isNaN(n)?'—': new Intl.NumberFormat('en-IN').format(Math.round(n)) );
    function pmt(r,n,pv){ if(r===0) return pv/n; const f=Math.pow(1+r,n); return (pv*r*f)/(f-1); }
    function pvExcel(r,n,pmt,fv=0){ if(r===0) return -(fv+pmt*n); return -(pmt*(1-Math.pow(1+r,-n))/r + fv*Math.pow(1+r,-n)); }
    function loanOutstanding(r,n,pmt,k){ return -pvExcel(r, n-k, pmt, 0); }
    function seriesWithStep(initial, months, stepM, stepR){ let out=[]; for(let m=1;m<=months;m++){ let steps=Math.floor((m-1)/stepM); out.push(initial*Math.pow(1+stepR, steps)); } return out; }

    function pullInputs(){ const gv=id=>+$(id).value||0; return {
      propVal:gv('propVal'), downPayment:gv('downPayment'), stampRate:gv('stampRate')/100, stayYears:gv('stayYears'), propApp:gv('propApp')/100,
      loanRateAnnual:gv('loanRate')/100, loanTenureYears:gv('loanTenure'),
      rent0:gv('rent0'), maint0:gv('maint0'), incInterval:gv('incInterval'), incRate:gv('incRate')/100,
      mfRateAnnual:gv('mfRate')/100, includeStampInMF:$('includeStampInMF').checked
    };}

    function computeScenario(inp){
      const months=inp.stayYears*12, rM=inp.loanRateAnnual/12, mfM=Math.pow(1+inp.mfRateAnnual,1/12)-1;
      const loanAmt=Math.max(0,inp.propVal-inp.downPayment), nTotal=inp.loanTenureYears*12;
      const emi=loanAmt>0? pmt(rM,nTotal,loanAmt):0, stampAmt=inp.propVal*inp.stampRate;
      const rents=seriesWithStep(inp.rent0,months,inp.incInterval,inp.incRate);
      const maints=seriesWithStep(inp.maint0,months,inp.incInterval,inp.incRate);
      let mf=inp.downPayment+(inp.includeStampInMF? stampAmt:0), totalRent=0,totalOwn=0;
      for(let i=0;i<months;i++){ let rent=rents[i],maint=maints[i]; totalRent+=rent+maint; totalOwn+=emi+maint; let surplus=Math.max(emi+maint-(rent+maint),0); mf=mf*(1+mfM)+surplus; }
      const fv=inp.propVal*Math.pow(1+inp.propApp,inp.stayYears), outEnd=loanOutstanding(rM,nTotal,emi,Math.min(months,nTotal));
      return {endBuy:fv-outEnd,endRent:mf,totalRent,totalOwn,stampAmt,emi,loanAmt,fv,outEnd}; }

    function render(a,inp){
      $('kpiBuy').textContent='₹'+fmt(a.endBuy); $('kpiRent').textContent='₹'+fmt(a.endRent);
      $('kpiRentTotal').textContent='₹'+fmt(a.totalRent); $('kpiBuyTotal').textContent='₹'+fmt(a.totalOwn); $('kpiStamp').textContent='₹'+fmt(a.stampAmt);
      $('buyNotes').textContent=`Loan ₹${fmt(a.loanAmt)} | EMI ₹${fmt(a.emi)}/mo`; $('rentNotes').textContent=`Corpus starts ₹${fmt(inp.downPayment+(inp.includeStampInMF?a.stampAmt:0))}`;
      const win=a.endBuy>a.endRent?'BUY':'RENT'; $('winnerBadge').textContent='Winner: '+win; $('winnerBadge').className='pill '+(win==='BUY'?'win':'');
      let lines=[]; lines.push(`Loan amount: ₹${fmt(a.loanAmt)}; EMI: ₹${fmt(a.emi)}`); lines.push(`Property FV: ₹${fmt(a.fv)}; Outstanding: ₹${fmt(a.outEnd)}`);
      lines.push(`Stamp Duty: ₹${fmt(a.stampAmt)}`); lines.push(`Totals → Rent: ₹${fmt(a.totalRent)}, Buy: ₹${fmt(a.totalOwn)}`); lines.push(`Results → Buy: ₹${fmt(a.endBuy)}, Rent: ₹${fmt(a.endRent)}`);
      $('calcText').textContent=lines.join('\n'); }

    function run(){ const inp=pullInputs(); const a=computeScenario(inp); render(a,inp); }
    function reset(){ ['propVal','downPayment','stampRate','stayYears','propApp','loanRate','loanTenure','rent0','maint0','incInterval','incRate','mfRate'].forEach(id=>{ $(id).value=$(id).defaultValue; }); $('includeStampInMF').checked=true; run(); }
    window.onload=()=>{ $('btnRun').onclick=run; $('btnReset').onclick=reset; run(); };
  </script>
</body>
</html>
